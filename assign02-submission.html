<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Arindom Baruah (32779267)">
<meta name="dcterms.date" content="2024-03-22">

<title>ETC5550 Assignment 2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Assignment2_5550_Arindom_32779267_files/libs/clipboard/clipboard.min.js"></script>
<script src="Assignment2_5550_Arindom_32779267_files/libs/quarto-html/quarto.js"></script>
<script src="Assignment2_5550_Arindom_32779267_files/libs/quarto-html/popper.min.js"></script>
<script src="Assignment2_5550_Arindom_32779267_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Assignment2_5550_Arindom_32779267_files/libs/quarto-html/anchor.min.js"></script>
<link href="Assignment2_5550_Arindom_32779267_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Assignment2_5550_Arindom_32779267_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Assignment2_5550_Arindom_32779267_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Assignment2_5550_Arindom_32779267_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Assignment2_5550_Arindom_32779267_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="Assignment2_5550_Arindom_32779267_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="Assignment2_5550_Arindom_32779267_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="assignment.css">
</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">ETC5550 Assignment 2</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Arindom Baruah (32779267) </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 22, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="libraries-used" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Libraries used</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fpp3)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(latex2exp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="glimpse-of-the-data" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Glimpse of the data</h1>
<p>Once we have obtained our data, let us take a quick glimpse of the data as illustrated by <a href="#tbl-data">Table&nbsp;1</a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-data" class="anchored">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Table&nbsp;1: Sample of the current retail data</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">State</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Industry</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Series ID</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Turnover</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Western Australia</td>
<td style="text-align: left;">Clothing, footwear and personal accessory retailing</td>
<td style="text-align: left;">A3349825J</td>
<td style="text-align: left;">1982 Apr</td>
<td style="text-align: right;">28.8</td>
</tr>
<tr class="even">
<td style="text-align: left;">Western Australia</td>
<td style="text-align: left;">Clothing, footwear and personal accessory retailing</td>
<td style="text-align: left;">A3349825J</td>
<td style="text-align: left;">1982 May</td>
<td style="text-align: right;">32.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Western Australia</td>
<td style="text-align: left;">Clothing, footwear and personal accessory retailing</td>
<td style="text-align: left;">A3349825J</td>
<td style="text-align: left;">1982 Jun</td>
<td style="text-align: right;">28.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">Western Australia</td>
<td style="text-align: left;">Clothing, footwear and personal accessory retailing</td>
<td style="text-align: left;">A3349825J</td>
<td style="text-align: left;">1982 Jul</td>
<td style="text-align: right;">29.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Western Australia</td>
<td style="text-align: left;">Clothing, footwear and personal accessory retailing</td>
<td style="text-align: left;">A3349825J</td>
<td style="text-align: left;">1982 Aug</td>
<td style="text-align: right;">25.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">Western Australia</td>
<td style="text-align: left;">Clothing, footwear and personal accessory retailing</td>
<td style="text-align: left;">A3349825J</td>
<td style="text-align: left;">1982 Sep</td>
<td style="text-align: right;">26.9</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</section>
<section id="exercises" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Exercises</h1>
<section id="sec-plot" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="sec-plot"><span class="header-section-number">3.1</span> Plotting of timeseries</h2>
<p>Let us observe the time series data for the turnover generated.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-turnover" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Assignment2_5550_Arindom_32779267_files/figure-html/fig-turnover-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1: Retailing turnover in Australia over time</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Key takeaway
</div>
</div>
<div class="callout-body-container callout-body">
<p>Based on <a href="#fig-turnover">Figure&nbsp;1</a> we can observe the following details in the timeseries plot:</p>
<ol type="1">
<li><p>There appears to be a seasonality in the plot with a spike being observed on every December of a year. <strong>The seasonality additionally appears to be consistent throughout the plot.</strong></p></li>
<li><p>The amplitude of the spikes observed in the data appear to be increasing with time. <strong>This indicates that the variation in seasonality of the data is multiplicative in nature.</strong></p></li>
<li><p>The plot also indicates the presence of an <strong>additive trend</strong> in the data with overall turnover increasing every year except for the year of 2020 in a linear fashion.</p></li>
<li><p>There appears to be an <strong>outlier in the data during the year of 2020</strong> as indicated by the <span style="color:red">red cricle</span>.While on each January of every year, we expect a rise in turnover, however, in the year of January 2020, the turnover was considerably lower than all the other years. This is expected to be caused due to <strong>shutting down of businesses and their activities in the initial part of the pandemic.</strong></p></li>
</ol>
</div>
</div>
</section>
<section id="sec-season" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="sec-season"><span class="header-section-number">3.2</span> Plotting of timeseries data with gg_season</h2>
<div class="cell">
<div class="cell-output-display">
<div id="fig-seasonplot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Assignment2_5550_Arindom_32779267_files/figure-html/fig-seasonplot-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2: Variation of retailing turnover within a year in Australia</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Key takeaway
</div>
</div>
<div class="callout-body-container callout-body">
<p><a href="#fig-seasonplot">Figure&nbsp;2</a> illustrates the turnover generated by the Australian retailers for each year. Some key observations are as follows:</p>
<ol type="1">
<li><p>The turnover generated in Australia has been on a rise each year. This suggests that the expenditure of people on retailing services in Australia have been increasing each year and could be attributed to the growing population in the country.</p></li>
<li><p>We observe that the retailing turnovers in each year are <strong>generally higher in the months of November and December</strong>. This could be a result of the festive period when there are many customers purchasing gifts for families or going out to eat in various restaurants, etc.</p></li>
<li><p>Additionally, the month of November also includes the <strong>Black Friday sale</strong> which attracts multiple customers to purchase items due to specialised promotions. This may indicate the slight rise in turnover during the month of November each year.</p></li>
<li><p>The <strong>rise in the retail turnovers for the month of December are especially higher during the more recent years (2011-2021)</strong>. This could again be an indicator for the growing population in the country during this period, which has gone on to to create a bigger market and drive sales, hence, contributing to the higher turnover.</p></li>
<li><p>There appears to be one single year when the retail <strong>turnover dropped steeply in the month of April but eventually picked up for the rest of the year.</strong> This could be an indicator of the effects of the COVID-19 lockdown when the business activities were very limited and prevented multiple retailers in various regions of Australia to be able to generate revenue.</p></li>
</ol>
</div>
</div>
</section>
<section id="plotting-of-timeseries-data-with-gg_subseries" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="plotting-of-timeseries-data-with-gg_subseries"><span class="header-section-number">3.3</span> Plotting of timeseries data with gg_subseries</h2>
<div class="cell">
<div class="cell-output-display">
<div id="fig-subseries" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Assignment2_5550_Arindom_32779267_files/figure-html/fig-subseries-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;3: Variation of retailing turnover in each month of a year in Australia</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Key takeaway
</div>
</div>
<div class="callout-body-container callout-body">
<p><a href="#fig-subseries">Figure&nbsp;3</a> illustrates the variation of retailing turnover faceted by each month and plotted against years. Key observations are as follows:</p>
<ol type="1">
<li><p>As already observed in <a href="#sec-season">Section&nbsp;3.2</a>, the plot suggests that the <strong>retailing turnover has increased each year from 1990 to 2022.</strong></p></li>
<li><p>The average <strong>retail turnover is observed to be higher for the month of December when compared to the rest of the year.</strong> As explained previously, the main driver for the boost of retailing turnover in this period is attributed to the festive season which includes Christmas, Boxing Day and the run up to the New Year Eve.</p></li>
<li><p>A <strong>drop in retail turnover for the months of March, April and May was observed in 2020.</strong> This can be attributed to the lockdowns set in place when the pandemic outbreak was first experienced.</p></li>
</ol>
</div>
</div>
</section>
<section id="box-cox-transformation-of-the-data" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="box-cox-transformation-of-the-data"><span class="header-section-number">3.4</span> Box-Cox transformation of the data</h2>
<section id="estimating-the-value-of-lambda" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="estimating-the-value-of-lambda"><span class="header-section-number">3.4.1</span> Estimating the value of <span class="math inline">\(\lambda\)</span></h3>
<p>In order to apply the Box-Cox transformation, we are required to obtain the appropriate value of the parameter <span class="math inline">\(\lambda\)</span> which will allow us to analyse the timeseries data with the seasonal variations being equal at all levels, thereby transforming the multiplicative variation in the data into an additive variation.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-sqrt" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Assignment2_5550_Arindom_32779267_files/figure-html/fig-sqrt-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;4: Transformation of the annual retailing turnover by square root transformation</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-sqrt">Figure&nbsp;4</a> illustrates a square root transformation. As we can observe, the <strong>square root transformation appears to be weak in nature</strong>, and hence, not be able to effectively make the variations in seasonality equal.</p>
<p>Let us now attempt to transform the data using <span class="math inline">\(\lambda = 0.25\)</span></p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-qtr" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Assignment2_5550_Arindom_32779267_files/figure-html/fig-qtr-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;5: Transformation of the annual retailing turnover by 1/4 root transformation</figcaption>
</figure>
</div>
</div>
</div>
<p>As observed in <a href="#fig-qtr">Figure&nbsp;5</a>, the transformation appears to be weak in the lower seasonality variation (towards the early years) as compared to the higher seasonality variation (towards the later years).</p>
<p>In order to increase the effect of the Box-Cox transformation, we will need to reduce the <span class="math inline">\(\lambda\)</span> value further. Let us try using <span class="math inline">\(\lambda = 0.1\)</span>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-ten" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Assignment2_5550_Arindom_32779267_files/figure-html/fig-ten-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;6: Transformation of the annual retailing turnover by 10th root transformation</figcaption>
</figure>
</div>
</div>
</div>
<p>Based on <a href="#fig-ten">Figure&nbsp;6</a>, it appears that a transformation with <span class="math inline">\(\lambda = 0.1\)</span> has still missed out in the seasonality variation during the early years as there still appears to be some amount of minor differences between the initial seasonality variation and the later seasonality variation.</p>
<p>Due to the inherent low sensitivity of the <span class="math inline">\(\lambda\)</span> parameter, we can consider that any value lower than 0.1 to have the same effect as when <span class="math inline">\(\lambda = 0\)</span>. This means that the Box-Cox transformation approaches towards a logarithmic transformation.</p>
<p>Let us attempt to visualise this by performing a log transformation through <span class="math inline">\(\lambda = 0\)</span></p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-transform-log" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Assignment2_5550_Arindom_32779267_files/figure-html/fig-transform-log-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;7: Transformation of the annual retailing turnover by Log transformation</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><a href="#fig-transform-log">Figure&nbsp;7</a> illustrates the timeseries data for retailing turnover after being transformed through the Box-Cox transformation on the log scale. Here are some key observations:</p>
<ol type="1">
<li><p>We observe that unlike the original data, the variation in seasonality of the Log transformed data was much more similar through the timeseries.</p></li>
<li><p>Using the Log transformation, the datapoints with lower seasonality variation (data in the initial time period) was stretched to larger variations while the datapoints with higher seasonality variation (data in the later time period) was compressed to relatively smaller variations.</p></li>
<li><p>Since the variations are fairly similar throughout the entire period of the data, we can consider the transformed data to contain an additive variation of seasonality.</p></li>
<li><p>Usage of a <strong>log transformation also provides better interpretability as changes in a log value are proportional to changes on the original scale, mulitplied by a factor.</strong></p></li>
</ol>
</div>
</div>
<p>We can additionally use the Guerrero transformation as a means to automate the process of obtaining a <span class="math inline">\(\lambda\)</span> value. Based on this optimisation technique, a value of <span class="math inline">\(\lambda = -0.09\)</span> was obtained. The corresponding plot upon transformation can be observed in <a href="#fig-transform">Figure&nbsp;8</a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-transform" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Assignment2_5550_Arindom_32779267_files/figure-html/fig-transform-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;8: Transformation of the annual retailing turnover data using Box-Cox method</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="stl-decomposition-of-the-timeseries-data" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="stl-decomposition-of-the-timeseries-data"><span class="header-section-number">3.5</span> STL decomposition of the timeseries data</h2>
<div class="cell">
<div class="cell-output-display">
<div id="fig-stl" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Assignment2_5550_Arindom_32779267_files/figure-html/fig-stl-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;9: STL decomposition of annual retailing turnover</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Key takeaway
</div>
</div>
<div class="callout-body-container callout-body">
<p>Based on the STL decomposition for the log based transformation done as illustrated by <a href="#fig-stl">Figure&nbsp;9</a>, we observe the following:</p>
<ol type="1">
<li><p>The trend of the transformed data suggests a <strong>somewhat linear (and hence an additive) rise in the overall annual retailing turnover.</strong></p></li>
<li><p>The <strong>seasonality of the data is observed to be fairly constant in each year, with a peak appearing during the end of the year as a result of the higher expenditures expected during the festive season.</strong></p></li>
<li><p>The <strong>remainder plot illustrates an outlier in the data close to the year of 2020. This indicates the underwhelming retailing turnovers due to the outbreak of COVID-19</strong> that resulted in the shutting down of many business activities for a period of few months.</p></li>
</ol>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>